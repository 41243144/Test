{# templates/includes/_head.html #}
{% load static wagtailcore_tags site_settings_tags %}

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

{# SEO Meta Tags #}
{% get_site_setting 'default_meta_title' as default_title %}
{% get_site_setting 'default_meta_description' as default_description %}
{% get_site_setting 'site_name' as site_name %}

{% if page.seo_title %}
  <title>{{ page.seo_title }}</title>
{% elif page.title %}
  <title>{{ page.title }} - {{ site_name|default:'尚虎雲平台' }}</title>
{% else %}
  <title>{{ default_title|default:'尚虎雲平台 - 農業生產銷售一體化平台' }}</title>
{% endif %}

{% if page.search_description %}
  <meta name="description" content="{{ page.search_description }}">
{% else %}
  <meta name="description" content="{{ default_description|default:'尚虎雲平台提供完整的農業生產銷售解決方案，連接農民與消費者，打造可持續的農業生態系統。' }}">
{% endif %}

{# Open Graph Meta Tags #}
{% get_site_setting 'site_logo' as site_logo %}
<meta property="og:type" content="website">
<meta property="og:url" content="{{ request.build_absolute_uri }}">
<meta property="og:site_name" content="{{ site_name|default:'尚虎雲平台' }}">

{% if page.seo_title %}
  <meta property="og:title" content="{{ page.seo_title }}">
{% elif page.title %}
  <meta property="og:title" content="{{ page.title }} - {{ site_name|default:'尚虎雲平台' }}">
{% else %}
  <meta property="og:title" content="{{ default_title|default:'尚虎雲平台 - 農業生產銷售一體化平台' }}">
{% endif %}

{% if page.search_description %}
  <meta property="og:description" content="{{ page.search_description }}">
{% else %}
  <meta property="og:description" content="{{ default_description|default:'尚虎雲平台提供完整的農業生產銷售解決方案，連接農民與消費者，打造可持續的農業生態系統。' }}">
{% endif %}

{% if site_logo %}
  <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ site_logo.file.url }}">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="{{ site_name|default:'尚虎雲平台' }} Logo">
{% endif %}

{# Twitter Card Meta Tags #}
<meta name="twitter:card" content="summary_large_image">
{% if page.seo_title %}
  <meta name="twitter:title" content="{{ page.seo_title }}">
{% elif page.title %}
  <meta name="twitter:title" content="{{ page.title }} - {{ site_name|default:'尚虎雲平台' }}">
{% else %}
  <meta name="twitter:title" content="{{ default_title|default:'尚虎雲平台 - 農業生產銷售一體化平台' }}">
{% endif %}

{% if page.search_description %}
  <meta name="twitter:description" content="{{ page.search_description }}">
{% else %}
  <meta name="twitter:description" content="{{ default_description|default:'尚虎雲平台提供完整的農業生產銷售解決方案，連接農民與消費者，打造可持續的農業生態系統。' }}">
{% endif %}

{% if site_logo %}
  <meta name="twitter:image" content="{{ request.scheme }}://{{ request.get_host }}{{ site_logo.file.url }}">
  <meta name="twitter:image:alt" content="{{ site_name|default:'尚虎雲平台' }} Logo">
{% endif %}

{# Additional SEO Meta Tags #}
<meta name="robots" content="index, follow">
<meta name="language" content="zh-TW">
<meta name="author" content="{{ site_name|default:'尚虎雲平台' }}">
<meta name="copyright" content="© {{ site_name|default:'尚虎雲平台' }}">
<meta name="theme-color" content="#cda45e">

{# Canonical URL #}
<link rel="canonical" href="{{ request.build_absolute_uri }}">

{% if request.in_preview_panel %}
  <base target="_blank">
{% endif %}

{# Favicons #}
{% get_site_setting 'favicon' as site_favicon %}
{% if site_favicon %}
  <link href="{{ site_favicon.file.url }}" rel="icon">
  <link href="{{ site_favicon.file.url }}" rel="apple-touch-icon">
  <link href="{{ site_favicon.file.url }}" rel="shortcut icon" type="image/x-icon">
{% else %}
  <link href="{% static 'assets/img/favicon.png' %}" rel="icon">
  <link href="{% static 'assets/img/apple-touch-icon.png' %}" rel="apple-touch-icon">
{% endif %}

{# DNS Prefetch for Performance #}
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">

{# Fonts preload #}
<link href="https://fonts.googleapis.com" rel="preconnect">
<link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto…&display=swap" rel="stylesheet">

{# Schema.org Structured Data #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ site_name|default:'尚虎雲平台' }}",
  "url": "{{ request.scheme }}://{{ request.get_host }}",
  {% if site_logo %}"logo": "{{ request.scheme }}://{{ request.get_host }}{{ site_logo.file.url }}",{% endif %}
  {% get_site_setting 'contact_email' as contact_email %}
  {% get_site_setting 'contact_phone' as contact_phone %}
  {% get_site_setting 'contact_address' as contact_address %}
  "contactPoint": {
    "@type": "ContactPoint",
    {% if contact_email %}"email": "{{ contact_email }}",{% endif %}
    {% if contact_phone %}"telephone": "{{ contact_phone }}",{% endif %}
    "contactType": "customer service"
  },
  {% if contact_address %}"address": {
    "@type": "PostalAddress",
    "addressLocality": "{{ contact_address }}"
  },{% endif %}
  "sameAs": [
    {% get_site_setting 'facebook_url' as facebook_url %}
    {% get_site_setting 'twitter_url' as twitter_url %}
    {% get_site_setting 'instagram_url' as instagram_url %}
    {% get_site_setting 'youtube_url' as youtube_url %}
    {% get_site_setting 'linkedin_url' as threads_url %}
    {% if facebook_url %}"{{ facebook_url }}"{% if twitter_url or instagram_url or youtube_url or threads_url %},{% endif %}{% endif %}
    {% if twitter_url %}"{{ twitter_url }}"{% if instagram_url or youtube_url or threads_url %},{% endif %}{% endif %}
    {% if instagram_url %}"{{ instagram_url }}"{% if youtube_url or threads_url %},{% endif %}{% endif %}
    {% if youtube_url %}"{{ youtube_url }}"{% if threads_url %},{% endif %}{% endif %}
    {% if threads_url %}"{{ threads_url }}"{% endif %}
  ]
}
</script>

{# Google Analytics #}
{% get_site_setting 'google_analytics_id' as ga_id %}
{% if ga_id %}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ ga_id }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ ga_id }}', {
      page_title: document.title,
      page_location: window.location.href
    });
  </script>
{% endif %}

{# Google Tag Manager #}
{% get_site_setting 'google_tag_manager_id' as gtm_id %}
{% if gtm_id %}
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','{{ gtm_id }}');</script>
{% endif %}

<!-- Vendor CSS -->
<link href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
<link href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
<link href="{% static 'assets/vendor/aos/aos.css' %}" rel="stylesheet">
<link href="{% static 'assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
<link href="{% static 'assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">

<!-- Font Awesome for icons -->
<link href="{% static 'assets/vendor/font-awesome/css/all.min.css' %}" rel="stylesheet">

<!-- Main CSS -->
<link href="{% static 'assets/css/main.css' %}" rel="stylesheet">

{% block extra_css %}{% endblock %}
